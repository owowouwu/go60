/*
 * Copyright (c) 2020 The ZMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

#include <dt-bindings/zmk/input_transform.h>
#include <input/processors.dtsi>
#include <zephyr/dt-bindings/input/input-event-codes.h>
#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/pointing.h>

// layers

#define LAYER_Base 0
#define LAYER_Keypad 1
#define LAYER_SymbolNav 2
#define LAYER_Magic 3
#define LAYER_Factory 4

/ {
    input_processors {
        zip_click_to_right_click_mapper: zip_click_to_right_click_mapper {
            compatible = "zmk,input-processor-code-mapper";
            #input-processor-cells = <0>;
            type = <INPUT_EV_KEY>;
            map = <INPUT_BTN_0 INPUT_BTN_1>;
        };
    };

    behaviors {
        oneshot_caps_or_capsword: oneshot_caps_or_capsword {
            compatible = "zmk,behavior-tap-dance";
            label = "ONESHOT_CAPS_OR_CAPSWORD";
            #binding-cells = <0>;
            bindings = <&sk LEFT_SHIFT>, <&caps_word>;
        };
    };

    keymap {
        compatible = "zmk,keymap";

        base {
            bindings = <
&kp GRAVE                  &kp N1  &kp N2     &kp N3     &kp N4    &kp N5                                                                                   &kp N6  &kp N7    &kp N8     &kp N9    &kp N0    &kp DELETE
&kp TAB                    &kp Q   &kp W      &kp E      &kp R     &kp T                                                                                    &kp Y   &kp U     &kp I      &kp O     &kp P     &kp BSLH
&mt LCTRL ESCAPE           &kp A   &kp S      &kp D      &kp F     &kp G                                                                                    &kp H   &kp J     &kp K      &kp L     &kp SEMI  &kp SQT
&oneshot_caps_or_capsword  &kp Z   &kp X      &kp C      &kp V     &kp B                                                                                    &kp N   &kp M     &kp COMMA  &kp DOT   &kp FSLH  &none
                                   &mkp LCLK  &mkp RCLK  &kp LGUI                                                                                                   &kp LGUI  &kp LBKT   &kp RBKT
                                                                           &kp LEFT_ALT  &sl 1  &mt LEFT_SHIFT ENTER  &kp LALT  &kp SPACE  &lt 3 BACKSPACE
            >;

            label = "BASE";
        };

        sym {
            bindings = <
&kp GRAVE      &kp F1         &kp F2         &kp F3         &kp F4        &kp F5                                                        &kp F6        &kp F7        &kp F8        &kp F9        &kp F10     &kp F11
&kp LS(TILDE)  &kp N1         &kp N2         &kp N3         &kp N4        &kp N5                                                        &kp N6        &kp N7        &kp N8        &kp N9        &kp N0      &kp LS(AMPS)
&kp LS(QMARK)  &kp LS(EXCL)   &kp MINUS      &kp LS(UNDER)  &kp EQUAL     &kp LS(STAR)                                                  &kp LS(LBRC)  &kp LS(RBRC)  &kp LS(LPAR)  &kp LS(RPAR)  &kp BSLH    &kp LS(PIPE)
&tog 1         &kp LS(POUND)  &kp LS(TILDE)  &kp LS(PRCNT)  &kp LS(PLUS)  &kp LS(DLLR)                                                  &kp LS(LT)    &kp LS(GT)    &kp LBKT      &kp RBKT      &kp LS(AT)  &kp LS(CARET)
                              &trans         &trans         &trans                                                                                    &trans        &trans        &trans
                                                                                        &trans  &trans  &trans  &trans  &trans  &trans
            >;

            label = "SYMBOL";
        };

        nav {
            bindings = <
&trans  &trans            &trans            &trans            &trans            &trans                                                  &trans         &trans         &trans    &trans        &trans        &trans
&trans  &kp LG(NUMBER_1)  &kp LG(NUMBER_2)  &kp LG(NUMBER_3)  &kp LG(NUMBER_4)  &trans                                                  &kp PAGE_DOWN  &kp LC(MINUS)  &kp UP    &kp LS(PLUS)  &kp N0        &kp BSPC
&trans  &kp LALT          &kp LCTRL         &kp LSHFT         &kp LGUI          &trans                                                  &kp PAGE_DOWN  &kp LEFT       &kp DOWN  &kp RIGHT     &kp LS(DLLR)  &kp LS(A)
&trans  &kp LC(Z)         &kp LC(X)         &kp LC(C)         &kp LC(V)         &trans                                                  &trans         &trans         &trans    &trans        &trans        &trans
                          &trans            &trans            &trans                                                                                   &trans         &trans    &trans
                                                                                        &trans  &trans  &trans  &trans  &trans  &trans
            >;

            label = "NAV";
        };

        sys {
            bindings = <
&trans  &trans  &trans  &trans             &trans            &trans                                                      &trans  &trans                &trans                &trans  &trans           &trans
&trans  &trans  &trans  &kp C_VOLUME_DOWN  &kp C_VOLUME_UP   &kp C_MUTE                                                  &trans  &kp C_BRIGHTNESS_DEC  &kp C_BRIGHTNESS_INC  &trans  &kp PRINTSCREEN  &trans
&trans  &trans  &trans  &kp C_PREVIOUS     &kp C_PLAY_PAUSE  &kp C_NEXT                                                  &trans  &trans                &trans                &trans  &trans           &trans
&trans  &trans  &trans  &trans             &trans            &trans                                                      &trans  &trans                &trans                &trans  &trans           &trans
                &trans  &trans             &trans                                                                                &trans                &trans                &trans
                                                                         &trans  &trans  &trans  &trans  &trans  &trans
            >;

            label = "SYS";
        };
    };
};

&cirque_rh_listener {
    input-processors = <&zip_xy_scaler 3 1>;

    layer_2 {
        layers = <2>;
        input-processors = <&zip_xy_scaler 9 1>;
    };
};

&cirque_lh_listener {
    input-processors =
        <&zip_xy_to_scroll_mapper>,
        <&zip_xy_scaler 1 8>,
        <&zip_click_to_right_click_mapper>;

    layer_4 {
        layers = <4>;
        input-processors = <&zip_xy_scaler 3 1>;
    };
};
